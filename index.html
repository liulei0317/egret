<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <title>情怀麻将</title>
    <meta name="viewport"
        content="width=device-width,initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="full-screen" content="true" />
    <meta name="screen-orientation" content="landscape" />
    <meta name="x5-orientation" content="landscape">
    <meta name="x5-fullscreen" content="true" />
    <meta name="360-fullscreen" content="true" />
    <style>
        html,
        body {
            -ms-touch-action: none;
            background: #000000;
            padding: 0;
            border: 0;
            margin: 0;
            height: 100%;
        }

        /*@font-face {
            font-family:"fzch";
            src: url("./resource/fonts/fzch.ttf");
        }        */
    </style>

    <style type="text/css">
        @font-face {
            font-family: "fzch";
            src: url("./resource/fonts/fzch.ttf");
            /*format("truetype");*/
            /*font-weight: normal;
            font-style: normal;*/
        }

        @font-face {
            font-family: "fzzy";
            src: url("./resource/fonts/fzzy.ttf");
            /*format("truetype");*/
            /*font-weight: normal;
            font-style: normal;*/
        }

        div {
            font-family: "fzch";
        }
    </style>
</head>

<body>
    <div style="margin: auto;width: 100%;height: 100%;" class="egret-player" data-entry-class="Main"
        data-orientation="landscape" data-scale-mode="fixedHeight" data-frame-rate="60" data-content-width="1280"
        data-content-height="720" data-multi-fingered="1" data-show-fps="false" data-show-log="false"
        data-show-fps-style="x:0,y:0,size:24,textColor:0xffffff,bgAlpha:0.9">
        <div id="preloading" style="margin:auto; width:auto; height:100vh; z-index:1000">
            <div style="position:relative;top:0;display:block;text-align:center;height: 100vh;width: auto;">
                <img src="resource/preload/bg_loading_nanjing.png" alt="" id="preloading_bg"
                    style="width: auto;height: 100vh; max-width: 100%; max-height: 100%;">
            </div>
            <div align="center"><img id="preloading_loading" src="resource/preload/loading.gif?v=" +Math.random()
                    style="position: absolute; top: 60%; margin-left: -38px;margin-top: -8px;object-fit: contain;" />
            </div>
            <p id="progressText"
                style="font-family:fzch;height: 20px; color: #4d4a4a; position: absolute; left:50%; top: 50%; transform: translateY(-50%);">
                0%</p>
        </div>
    </div>
    <div id="divImage"
        style="background: #373737;display:none;text-align:center;z-index:99;width:100%;height:100%;position: fixed;">
        <div style="position:relative;top:0;color: #ffffff;display:block;text-align:center;height: 100%;width: auto;">
            <img src="" alt="" id="shareImage" style="width: auto;height: 100%;">
        </div>
        <div
            style="opacity: 0.4; background: #000000;position: absolute;top:0;color: #000000;text-align:center;height: 100%;width: 100%;pointer-events:none;">
        </div>
        <img src="./resource/preload/H5share/btn_h5_backgame1.png" onclick="isHidden('divImage')" alt=""
            style="position:absolute;right:5%;top:1%; width: 10vw; height: auto;">
        <img src="./resource/preload/H5share/img_h5_changan.png" alt=""
            style="position:absolute;left:20%;top:1%; width: 50vw; height: auto;pointer-events:none;">
        <img src="./resource/preload/H5share/img_h5_finger.png" alt=""
            style="position:absolute;left:44%;top:30%; width: 12vw; height: auto;pointer-events:none;">
    </div>
    <script>
        ///这里添加点击 X 按钮关闭
        function isHidden(idtext) {
            var vDiv = document.getElementById(idtext);
            vDiv.style.display = 'none';
        }
    </script>
    <script>
        var detectOrientOri = function () {
            var width = document.documentElement.clientWidth,
                height = document.documentElement.clientHeight,
                $wrapper = document.getElementById("preloading"),
                $bg = document.getElementById("preloading_bg"),
                styleBg = "",
                style = "";

            if (width >= height) { // 横屏
                style += "width:" + 100 + "vw;"; // 注意旋转后的宽高切换
                style += "height:" + 100 + "vh;";
                style += "-webkit-transform: rotate(0); transform: rotate(0);";
                style += "-webkit-transform-origin: 0 0;";
                style += "transform-origin: 0 0;";
                styleBg += "width:auto;";
                styleBg += "height:" + 100 + "vh;";
                styleBg += "max-width:100%;max-height: 100%;";

            }
            else { // 竖屏
                style += "width:" + 100 + "vh;";
                style += "height:" + 100 + "vw;";
                style += "-webkit-transform: rotate(90deg); transform: rotate(90deg);";
                // 注意旋转中点的处理
                style += "-webkit-transform-origin: " + 50 + "vw " + 50 + "vw;";
                style += "transform-origin: " + 50 + "vw " + 50 + "vw;";
                styleBg += "width:" + 100 + "vh;";
                styleBg += "height:" + 100 + "vw;";
            }
            $wrapper.style.cssText = style;
            $bg.style.cssText = styleBg;
        }
        var detectOrient = function () {
            setTimeout(function () {
                detectOrientOri()
            }, 300)
        }
        // var evt = "onorientationchange" in window ? "orientationchange" : "resize";
        // window.addEventListener(evt, detectOrient)
        // detectOrientOri();
        var loadScript = function (list, callback) {
            var loaded = 0;
            var loadNext = function () {
                loadSingleScript(list[loaded], function () {
                    loaded++;

                    var lb = document.getElementById("progressText")
                    lb.innerHTML = "" + (loaded / list.length * 100).toFixed(0) + "%"
                    lb.style.marginLeft = (-(lb.clientWidth / 2)) + "px"

                    if (loaded >= list.length) {
                        callback();
                    }
                    else {
                        loadNext();
                    }
                })
            };
            loadNext();
        };

        var loadSingleScript = function (src, callback) {
            var s = document.createElement('script');
            s.async = false;
            s.src = src;
            s.addEventListener('load', function () {
                s.parentNode.removeChild(s);
                s.removeEventListener('load', arguments.callee, false);
                callback();
            }, false);
            document.body.appendChild(s);
        };

        var xhr = new XMLHttpRequest();
        xhr.open('GET', './manifest.json?v=' + Math.random(), true);
        xhr.addEventListener("load", function () {
            var manifest = JSON.parse(xhr.response);
            var list = manifest.initial.concat(manifest.game);
            loadScript(list, function () {
                /**
                 * {
                 * "renderMode":, //Engine rendering mode, "canvas" or "webgl"
                 * "audioType": 0 //Use the audio type, 0: default, 2: web audio, 3: audio
                 * "antialias": //Whether the anti-aliasing is enabled in WebGL mode, true: on, false: off, defaults to false
                 * "calculateCanvasScaleFactor": //a function return canvas scale factor
                 * }
                 **/
                // window.removeEventListener('resize', detectOrient, false);
                // window.removeEventListener('orientationchange', detectOrient, false);
                document.fonts.ready.then(success, fail);
                function success() {
                    console.info("load font success.");
                    egret.runEgret({
                        renderMode: "webgl", audioType: 0, calculateCanvasScaleFactor: function (context) {
                            var backingStore = context.backingStorePixelRatio ||
                                context.webkitBackingStorePixelRatio ||
                                context.mozBackingStorePixelRatio ||
                                context.msBackingStorePixelRatio ||
                                context.oBackingStorePixelRatio ||
                                context.backingStorePixelRatio || 1;
                            return (window.devicePixelRatio || 1) / backingStore;
                        }
                    });
                }
                function fail() {
                    console.info("load font failed.");
                }


                // egret.runEgret({ renderMode: "webgl", audioType: 0, calculateCanvasScaleFactor:function(context) {
                //     var backingStore = context.backingStorePixelRatio ||
                //         context.webkitBackingStorePixelRatio ||
                //         context.mozBackingStorePixelRatio ||
                //         context.msBackingStorePixelRatio ||
                //         context.oBackingStorePixelRatio ||
                //         context.backingStorePixelRatio || 1;
                //     return (window.devicePixelRatio || 1) / backingStore;
                // }});
            });
        });
        xhr.send(null);
    </script>
</body>

</html>